--// Services
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

--// UI Setup
local ScreenGui = Instance.new("ScreenGui", LocalPlayer.PlayerGui)
local MainFrame = Instance.new("Frame", ScreenGui)
MainFrame.Size = UDim2.new(0, 300, 0, 400)
MainFrame.Position = UDim2.new(0.35, 0, 0.25, 0)
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
MainFrame.Active = true
MainFrame.Draggable = true

local Title = Instance.new("TextLabel", MainFrame)
Title.Size = UDim2.new(1, 0, 0, 40)
Title.Text = "Devon's Arsenal (v12)"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.BackgroundColor3 = Color3.fromRGB(50, 50, 50)

-- Helper function for buttons
local function createButton(name, pos)
	local btn = Instance.new("TextButton", MainFrame)
	btn.Size = UDim2.new(0.9, 0, 0, 40)
	btn.Position = UDim2.new(0.05, 0, 0, pos)
	btn.Text = name.." [OFF]"
	btn.BackgroundColor3 = Color3.fromRGB(80, 0, 0)
	btn.TextColor3 = Color3.new(1,1,1)
	return btn
end

--// Buttons
local AimbotBtn = createButton("Aimbot", 50)
local TargetPartBtn = createButton("Target: Head", 100)
local ESPBtn = createButton("ESP", 150)
local HitboxBtn = createButton("Hitbox Extender", 200)
local FlyBtn = createButton("Fly", 250)
local NoclipBtn = createButton("Noclip", 300)

--// States
local aimbotEnabled, espEnabled, hitboxEnabled, flyEnabled, noclipEnabled = false, false, false, false, false
local targetPart = "Head"
local flySpeed = 3
local hitboxSize = Vector3.new(5, 5, 5)
local hitboxColor = Color3.fromRGB(255, 0, 0)
local espColor = Color3.fromRGB(0, 255, 0)

--// Toggle system
local function toggle(btn, stateVar)
	if not _G[stateVar] then
		_G[stateVar] = true
		btn.Text = btn.Text:gsub("%[OFF%]", "[ON]")
		btn.BackgroundColor3 = Color3.fromRGB(0, 100, 0)
	else
		_G[stateVar] = false
		btn.Text = btn.Text:gsub("%[ON%]", "[OFF]")
		btn.BackgroundColor3 = Color3.fromRGB(100, 0, 0)
	end
end

-- Aimbot logic
local fov = 200
local function getClosestTarget()
	local closest, dist = nil, fov
	for _,plr in pairs(Players:GetPlayers()) do
		if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild(targetPart) and plr.Team ~= LocalPlayer.Team then
			local part = plr.Character[targetPart]
			local screenPos, onScreen = Camera:WorldToViewportPoint(part.Position)
			if onScreen then
				local mag = (Vector2.new(screenPos.X, screenPos.Y) - UserInputService:GetMouseLocation()).Magnitude
				if mag < dist then
					closest, dist = part, mag
				end
			end
		end
	end
	return closest
end

RunService.RenderStepped:Connect(function()
	if _G["aimbotEnabled"] and UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton2) then
		local target = getClosestTarget()
		if target then
			Camera.CFrame = CFrame.new(Camera.CFrame.Position, target.Position)
		end
	end
end)

-- ESP logic
local espCache = {}
RunService.RenderStepped:Connect(function()
	if _G["espEnabled"] then
		for _,plr in pairs(Players:GetPlayers()) do
			if plr ~= LocalPlayer and plr.Character and plr.Team ~= LocalPlayer.Team then
				local head = plr.Character:FindFirstChild("Head")
				if head then
					local box = espCache[plr] or Drawing.new("Box")
					box.Visible = true
					box.Color = espColor
					local pos, vis = Camera:WorldToViewportPoint(head.Position)
					if vis then
						box.Position = Vector2.new(pos.X-25,pos.Y-50)
						box.Size = Vector2.new(50,100)
					else
						box.Visible = false
					end
					espCache[plr] = box
				end
			end
		end
	else
		for _,box in pairs(espCache) do
			box.Visible = false
		end
	end
end)

-- Hitbox extender
RunService.Stepped:Connect(function()
	if _G["hitboxEnabled"] then
		for _,plr in pairs(Players:GetPlayers()) do
			if plr ~= LocalPlayer and plr.Character and plr.Team ~= LocalPlayer.Team then
				local hrp = plr.Character:FindFirstChild("HumanoidRootPart")
				if hrp then
					hrp.Size = hitboxSize
					hrp.BrickColor = BrickColor.new(hitboxColor)
					hrp.Transparency = 0.5
					hrp.CanCollide = false
				end
			end
		end
	end
end)

-- Fly + Noclip
local function fly()
	local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
	local hrp = char:WaitForChild("HumanoidRootPart")
	RunService.RenderStepped:Connect(function()
		if _G["flyEnabled"] then
			local move = Vector3.zero
			if UserInputService:IsKeyDown(Enum.KeyCode.W) then move += Camera.CFrame.LookVector end
			if UserInputService:IsKeyDown(Enum.KeyCode.S) then move -= Camera.CFrame.LookVector end
			if UserInputService:IsKeyDown(Enum.KeyCode.A) then move -= Camera.CFrame.RightVector end
			if UserInputService:IsKeyDown(Enum.KeyCode.D) then move += Camera.CFrame.RightVector end
			hrp.Velocity = move * flySpeed * 10
		end
		if _G["noclipEnabled"] then
			for _,part in pairs(char:GetDescendants()) do
				if part:IsA("BasePart") then
					part.CanCollide = false
				end
			end
		end
	end)
end
fly()

-- Button Connections
AimbotBtn.MouseButton1Click:Connect(function() toggle(AimbotBtn,"aimbotEnabled") end)
TargetPartBtn.MouseButton1Click:Connect(function()
	targetPart = (targetPart == "Head" and "HumanoidRootPart" or "Head")
	TargetPartBtn.Text = "Target: "..(targetPart == "Head" and "Head" or "Torso")
end)
ESPBtn.MouseButton1Click:Connect(function() toggle(ESPBtn,"espEnabled") end)
HitboxBtn.MouseButton1Click:Connect(function() toggle(HitboxBtn,"hitboxEnabled") end)
FlyBtn.MouseButton1Click:Connect(function() toggle(FlyBtn,"flyEnabled") end)
NoclipBtn.MouseButton1Click:Connect(function() toggle(NoclipBtn,"noclipEnabled") end)

print("Menu Loaded âœ…")
