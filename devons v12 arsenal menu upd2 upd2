--// Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local PlayerGui = Players.LocalPlayer:WaitForChild("PlayerGui")
local Camera = workspace.CurrentCamera

--// ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "DevonsArsenalMenu"
ScreenGui.Parent = PlayerGui

--// Main Frame
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 450, 0, 350)
MainFrame.Position = UDim2.new(0.5, -225, 0.5, -175)
MainFrame.BackgroundColor3 = Color3.fromRGB(40,40,40)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui

--// Header
local Header = Instance.new("TextLabel")
Header.Size = UDim2.new(1,0,0,50)
Header.Position = UDim2.new(0,0,0,0)
Header.BackgroundColor3 = Color3.fromRGB(60,60,60)
Header.BorderSizePixel = 0
Header.Text = "Devons Arsenal Menu (v12)"
Header.TextColor3 = Color3.fromRGB(255,255,255)
Header.Font = Enum.Font.GothamBold
Header.TextSize = 24
Header.Parent = MainFrame

--// Close Label
local CloseLabel = Instance.new("TextLabel")
CloseLabel.Size = UDim2.new(1,0,0,20)
CloseLabel.Position = UDim2.new(0,0,1,-25)
CloseLabel.BackgroundTransparency = 1
CloseLabel.Text = "Right Ctrl to Close"
CloseLabel.TextColor3 = Color3.fromRGB(200,200,200)
CloseLabel.Font = Enum.Font.Gotham
CloseLabel.TextSize = 16
CloseLabel.Parent = MainFrame

--// Button Creator
local function createButton(name, yPos)
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0.8,0,0,40)
    btn.Position = UDim2.new(0.1,0,0,yPos)
    btn.BackgroundColor3 = Color3.fromRGB(150,0,0)
    btn.BorderSizePixel = 0
    btn.Text = name
    btn.TextColor3 = Color3.fromRGB(255,255,255)
    btn.Font = Enum.Font.Gotham
    btn.TextSize = 20
    btn.Parent = MainFrame
    return btn
end

--// Buttons
local AimbotButton = createButton("Aimbot", 60)
local ESPButton = createButton("ESP", 120)
local HitboxButton = createButton("Hitbox Extender", 180)

--// Toggle States
local aimbotEnabled = false
local espEnabled = false
local hitboxEnabled = false
local hitboxSize = 5
local aimbotPart = "Head"
local flyEnabled = false
local flySpeed = 50
local noclipEnabled = false

--// Update Button Colors
local function updateButtonColor(btn,state)
    if state then
        btn.BackgroundColor3 = Color3.fromRGB(0,200,0)
    else
        btn.BackgroundColor3 = Color3.fromRGB(150,0,0)
    end
end

--// Close Menu Keybind
UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.RightControl then
        ScreenGui.Enabled = not ScreenGui.Enabled
    end
end)

--// Button Events
AimbotButton.MouseButton1Click:Connect(function()
    aimbotEnabled = not aimbotEnabled
    updateButtonColor(AimbotButton, aimbotEnabled)
end)

ESPButton.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    updateButtonColor(ESPButton, espEnabled)
end)

HitboxButton.MouseButton1Click:Connect(function()
    hitboxEnabled = not hitboxEnabled
    updateButtonColor(HitboxButton, hitboxEnabled)
end)

--// Utility Functions
local function isEnemy(plr)
    return plr.Team ~= Players.LocalPlayer.Team
end

--// ESP Table
local ESPBoxes = {}

local function createESP(plr)
    if ESPBoxes[plr] then return end
    local box = Drawing.new("Quad")
    box.Color = Color3.fromRGB(255,0,0)
    box.Thickness = 2
    box.Transparency = 0.5
    box.Visible = true
    ESPBoxes[plr] = box
end

local function removeESP(plr)
    if ESPBoxes[plr] then
        ESPBoxes[plr]:Remove()
        ESPBoxes[plr] = nil
    end
end

--// Main Loop
RunService.RenderStepped:Connect(function()
    local mouse = Players.LocalPlayer:GetMouse()
    
    -- Aimbot
    if aimbotEnabled and UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton2) then
        local closest
        local shortest = math.huge
        for _,plr in pairs(Players:GetPlayers()) do
            if plr ~= Players.LocalPlayer and isEnemy(plr) and plr.Character and plr.Character:FindFirstChild(aimbotPart) then
                local screenPos, onScreen = Camera:WorldToViewportPoint(plr.Character[aimbotPart].Position)
                if onScreen then
                    local dist = (Vector2.new(mouse.X,mouse.Y) - Vector2.new(screenPos.X,screenPos.Y)).Magnitude
                    if dist < shortest then
                        shortest = dist
                        closest = plr
                    end
                end
            end
        end
        if closest and closest.Character and closest.Character:FindFirstChild(aimbotPart) then
            Camera.CFrame = CFrame.new(Camera.CFrame.Position, closest.Character[aimbotPart].Position)
        end
    end

    -- Hitbox Extender
    if hitboxEnabled then
        for _,plr in pairs(Players:GetPlayers()) do
            if plr ~= Players.LocalPlayer and isEnemy(plr) and plr.Character then
                for _,part in pairs(plr.Character:GetChildren()) do
                    if part:IsA("BasePart") then
                        part.Size = Vector3.new(hitboxSize,hitboxSize,hitboxSize)
                        part.Transparency = 0.5
                    end
                end
            end
        end
    end

    -- ESP Update
    if espEnabled then
        for _,plr in pairs(Players:GetPlayers()) do
            if plr ~= Players.LocalPlayer and isEnemy(plr) and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
                local hrp = plr.Character.HumanoidRootPart
                local screenPos, onScreen = Camera:WorldToViewportPoint(hrp.Position)
                if onScreen then
                    if not ESPBoxes[plr] then createESP(plr) end
                    local size = Vector2.new(50,50)
                    local topLeft = Vector2.new(screenPos.X - size.X/2, screenPos.Y - size.Y/2)
                    local bottomRight = topLeft + size
                    local box = ESPBoxes[plr]
                    box.PointA = topLeft
                    box.PointB = Vector2.new(bottomRight.X, topLeft.Y)
                    box.PointC = bottomRight
                    box.PointD = Vector2.new(topLeft.X, bottomRight.Y)
                    box.Visible = true
                else
                    if ESPBoxes[plr] then ESPBoxes[plr].Visible = false end
                end
            else
                removeESP(plr)
            end
        end
    end
end)
