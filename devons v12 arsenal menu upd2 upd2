--// Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local player = Players.LocalPlayer
local PlayerGui = player:WaitForChild("PlayerGui")
local Camera = workspace.CurrentCamera
local mouse = player:GetMouse()

--// Create ScreenGui
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "DevonsArsenalMenu"
ScreenGui.Parent = PlayerGui

--// Main Frame
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 480, 0, 700)
MainFrame.Position = UDim2.new(0.5, -240, 0.5, -350)
MainFrame.BackgroundColor3 = Color3.fromRGB(40,40,45)
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui

-- Gradient
local gradient = Instance.new("UIGradient")
gradient.Color = ColorSequence.new{
	ColorSequenceKeypoint.new(0, Color3.fromRGB(50,50,60)),
	ColorSequenceKeypoint.new(1, Color3.fromRGB(25,25,30))
}
gradient.Rotation = 45
gradient.Parent = MainFrame

--// Title
local TitleLabel = Instance.new("TextLabel")
TitleLabel.Size = UDim2.new(1,0,0,50)
TitleLabel.Position = UDim2.new(0,0,0,0)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Text = "Devons Arsenal (v12)"
TitleLabel.TextColor3 = Color3.fromRGB(255,255,255)
TitleLabel.Font = Enum.Font.GothamBold
TitleLabel.TextSize = 28
TitleLabel.Parent = MainFrame

--// Helper: Buttons
local function createButton(name, y)
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(0.8,0,0,40)
	btn.Position = UDim2.new(0.1,0,0,y)
	btn.BackgroundColor3 = Color3.fromRGB(150,0,0)
	btn.BorderSizePixel = 0
	btn.Font = Enum.Font.Gotham
	btn.TextSize = 20
	btn.TextColor3 = Color3.fromRGB(255,255,255)
	btn.Text = name
	btn.Parent = MainFrame
	btn.MouseEnter:Connect(function() TweenService:Create(btn,TweenInfo.new(0.2),{BackgroundColor3=Color3.fromRGB(180,0,0)}):Play() end)
	btn.MouseLeave:Connect(function() TweenService:Create(btn,TweenInfo.new(0.2),{BackgroundColor3=Color3.fromRGB(150,0,0)}):Play() end)
	return btn
end

--// Helper: Slider
local function createSlider(name, min, max, yPos, default)
	local lbl = Instance.new("TextLabel")
	lbl.Size = UDim2.new(0.8,0,0,25)
	lbl.Position = UDim2.new(0.1,0,0,yPos)
	lbl.BackgroundTransparency = 1
	lbl.TextColor3 = Color3.fromRGB(255,255,255)
	lbl.Font = Enum.Font.Gotham
	lbl.TextSize = 18
	lbl.Text = name..": "..default
	lbl.Parent = MainFrame

	local frame = Instance.new("Frame")
	frame.Size = UDim2.new(0.8,0,0,10)
	frame.Position = UDim2.new(0.1,0,0,yPos+25)
	frame.BackgroundColor3 = Color3.fromRGB(80,80,80)
	frame.Parent = MainFrame

	local fill = Instance.new("Frame")
	fill.Size = UDim2.new((default-min)/(max-min),0,1,0)
	fill.BackgroundColor3 = Color3.fromRGB(0,200,0)
	fill.Parent = frame

	frame.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			local conn
			conn = UserInputService.InputChanged:Connect(function(move)
				if move.UserInputType == Enum.UserInputType.MouseMovement then
					local rel = math.clamp((move.Position.X - frame.AbsolutePosition.X)/frame.AbsoluteSize.X,0,1)
					fill.Size = UDim2.new(rel,0,1,0)
					local value = math.floor(min + rel*(max-min))
					lbl.Text = name..": "..value
					lbl.Value = value
				end
			end)
			local endConn
			endConn = UserInputService.InputEnded:Connect(function(endInput)
				if endInput.UserInputType == Enum.UserInputType.MouseButton1 then
					conn:Disconnect()
					endConn:Disconnect()
				end
			end)
		end
	end)
	lbl.Value = default
	return lbl
end

--// Helper: Color Label
local function createColorLabel(name, color, yPos)
	local lbl = Instance.new("TextLabel")
	lbl.Size = UDim2.new(0.8,0,0,25)
	lbl.Position = UDim2.new(0.1,0,0,yPos)
	lbl.BackgroundTransparency = 1
	lbl.Text = name
	lbl.Font = Enum.Font.Gotham
	lbl.TextSize = 18
	lbl.TextColor3 = color
	lbl.Parent = MainFrame
	return lbl
end

--// Buttons
local startY = 70
local AimbotBtn = createButton("Aimbot", startY)
local ESPBtn = createButton("ESP", startY+60)
local HitboxBtn = createButton("Hitbox Visual", startY+120)
local FlyBtn = createButton("Fly", startY+180)
local NoclipBtn = createButton("Noclip", startY+240)
local HeadTorsoBtn = createButton("Aimbot Part: Head", startY+300)

--// Sliders
local FOVSlider = createSlider("Aimbot FOV",50,500,startY+360,150)
local HitboxSlider = createSlider("Hitbox Size",2,20,startY+420,5)
local FlySpeedSlider = createSlider("Fly Speed",20,300,startY+480,50)

--// Color labels
local ESPColorLbl = createColorLabel("ESP Color",Color3.fromRGB(255,0,0),startY+540)
local HitboxColorLbl = createColorLabel("Hitbox Color",Color3.fromRGB(255,0,0),startY+570)

--// Menu toggle key
local toggleKey = Enum.KeyCode.RightShift
local menuVisible = true

local KeybindLabel = Instance.new("TextLabel")
KeybindLabel.Size = UDim2.new(0.8,0,0,25)
KeybindLabel.Position = UDim2.new(0.1,0,0,650)
KeybindLabel.BackgroundTransparency = 1
KeybindLabel.Text = "Toggle Menu Key: "..tostring(toggleKey.Name)
KeybindLabel.Font = Enum.Font.Gotham
KeybindLabel.TextSize = 18
KeybindLabel.TextColor3 = Color3.fromRGB(255,255,255)
KeybindLabel.Parent = MainFrame

KeybindLabel.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		KeybindLabel.Text = "Press a key..."
		local conn
		conn = UserInputService.InputBegan:Connect(function(key)
			if key.UserInputType == Enum.UserInputType.Keyboard then
				toggleKey = key.KeyCode
				KeybindLabel.Text = "Toggle Menu Key: "..tostring(toggleKey.Name)
				conn:Disconnect()
			end
		end)
	end
end)

UserInputService.InputBegan:Connect(function(input, gameProcessed)
	if gameProcessed then return end
	if input.KeyCode == toggleKey then
		MainFrame.Visible = not MainFrame.Visible
		menuVisible = MainFrame.Visible
	end
end)

--// States
local aimbotEnabled, espEnabled, hitboxEnabled, flyEnabled, noclipEnabled = false,false,false,false,false
local aimPart = "Head"
local ESPBoxes = {}

--// Functions
local function isEnemy(p)
	return p~=player and p.Team ~= player.Team
end

local function createESP(p)
	if ESPBoxes[p] then return end
	if p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
		local box = Instance.new("BillboardGui")
		box.Adornee = p.Character.HumanoidRootPart
		box.Size = UDim2.new(0,50,0,50)
		box.AlwaysOnTop = true
		local frame = Instance.new("Frame")
		frame.Size = UDim2.new(1,0,1,0)
		frame.BackgroundTransparency = 0.5
		frame.BackgroundColor3 = ESPColorLbl.TextColor3
		frame.Parent = box
		box.Parent = PlayerGui
		ESPBoxes[p] = {box=box,frame=frame}
	end
end

local function removeESP(p)
	if ESPBoxes[p] then
		ESPBoxes[p].box:Destroy()
		ESPBoxes[p] = nil
	end
end

--// Button Events
AimbotBtn.MouseButton1Click:Connect(function()
	aimbotEnabled = not aimbotEnabled
	AimbotBtn.BackgroundColor3 = aimbotEnabled and Color3.fromRGB(0,200,0) or Color3.fromRGB(150,0,0)
end)
ESPBtn.MouseButton1Click:Connect(function()
	espEnabled = not espEnabled
	ESPBtn.BackgroundColor3 = espEnabled and Color3.fromRGB(0,200,0) or Color3.fromRGB(150,0,0)
	if espEnabled then
		for _,p in pairs(Players:GetPlayers()) do if isEnemy(p) then createESP(p) end end
	else
		for p,_ in pairs(ESPBoxes) do removeESP(p) end
	end
end)
HitboxBtn.MouseButton1Click:Connect(function()
	hitboxEnabled = not hitboxEnabled
	HitboxBtn.BackgroundColor3 = hitboxEnabled and Color3.fromRGB(0,200,0) or Color3.fromRGB(150,0,0)
end)
FlyBtn.MouseButton1Click:Connect(function()
	flyEnabled = not flyEnabled
	FlyBtn.BackgroundColor3 = flyEnabled and Color3.fromRGB(0,200,0) or Color3.fromRGB(150,0,0)
end)
NoclipBtn.MouseButton1Click:Connect(function()
	noclipEnabled = not noclipEnabled
	NoclipBtn.BackgroundColor3 = noclipEnabled and Color3.fromRGB(0,200,0) or Color3.fromRGB(150,0,0)
end)
HeadTorsoBtn.MouseButton1Click:Connect(function()
	if aimPart=="Head" then aimPart="Torso" HeadTorsoBtn.Text="Aimbot Part: Torso"
	else aimPart="Head" HeadTorsoBtn.Text="Aimbot Part: Head" end
end)

--// FOV Circle
local FOVCircle = Drawing.new("Circle")
FOVCircle.Color = Color3.fromRGB(0,255,0)
FOVCircle.Thickness = 2
FOVCircle.Filled = false
FOVCircle.Visible = false
FOVCircle.Radius = FOVSlider.Value

--// Main Loop
RunService.RenderStepped:Connect(function()
	local fov = FOVSlider.Value
	local hitboxSize = HitboxSlider.Value
	local flySpeed = FlySpeedSlider.Value

	-- FOV Circle
	if aimbotEnabled then
		FOVCircle.Radius = fov
		FOVCircle.Position = Vector2.new(mouse.X, mouse.Y)
		FOVCircle.Visible = true
	else
		FOVCircle.Visible = false
	end

	-- ESP
	if espEnabled then
		for _,p in pairs(Players:GetPlayers()) do
			if isEnemy(p) and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
				if not ESPBoxes[p] then createESP(p) end
				local hrp = p.Character.HumanoidRootPart
				local pos, onScreen = Camera:WorldToViewportPoint(hrp.Position)
				local box = ESPBoxes[p].frame
				if onScreen then
					box.Visible = true
					box.Position = UDim2.new(0, pos.X-25, 0, pos.Y-50)
					box.Size = UDim2.new(0, 50, 0, 50)
					box.BackgroundColor3 = ESPColorLbl.TextColor3
				else
					box.Visible = false
				end
			end
		end
	end

	-- Hitbox Visual
	if hitboxEnabled then
		for _,p in pairs(Players:GetPlayers()) do
			if isEnemy(p) and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
				local hrp = p.Character.HumanoidRootPart
				hrp.Size = Vector3.new(hitboxSize,hitboxSize,hitboxSize)
				hrp.Transparency = 0.5
				hrp.BrickColor = BrickColor.new(HitboxColorLbl.TextColor3)
			end
		end
	end

	-- Fly
	if flyEnabled and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
		local hrp = player.Character.HumanoidRootPart
		local dir = Vector3.new()
		if UserInputService:IsKeyDown(Enum.KeyCode.W) then dir = dir + hrp.CFrame.LookVector end
		if UserInputService:IsKeyDown(Enum.KeyCode.S) then dir = dir - hrp.CFrame.LookVector end
		if UserInputService:IsKeyDown(Enum.KeyCode.A) then dir = dir - hrp.CFrame.RightVector end
		if UserInputService:IsKeyDown(Enum.KeyCode.D) then dir = dir + hrp.CFrame.RightVector end
		if UserInputService:IsKeyDown(Enum.KeyCode.Space) then dir = dir + Vector3.new(0,1,0) end
		if UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) then dir = dir - Vector3.new(0,1,0) end
		if dir.Magnitude>0 then hrp.Velocity = dir.Unit*flySpeed else hrp.Velocity=Vector3.new() end
	end

	-- Noclip
	if noclipEnabled and player.Character then
		for _,part in pairs(player.Character:GetDescendants()) do
			if part:IsA("BasePart") then
				part.CanCollide = false
			end
		end
	end
end)

--// Player Added/Removed
Players.PlayerAdded:Connect(function(p) if espEnabled and isEnemy(p) then createESP(p) end end)
Players.PlayerRemoving:Connect(function(p) removeESP(p) end)
