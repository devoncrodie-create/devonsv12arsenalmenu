    -- Part Toggle (Head/Torso)
    local PartToggle = Instance.new("TextButton")
    PartToggle.Size = UDim2.new(0,60,0,30)
    PartToggle.Position = UDim2.new(0.65,0,80/650,5)
    PartToggle.BackgroundColor3 = Color3.fromRGB(0,150,0)
    PartToggle.BorderSizePixel = 0
    PartToggle.Text = MenuState.aimbotPart
    PartToggle.TextColor3 = Color3.fromRGB(255,255,255)
    PartToggle.Font = Enum.Font.Gotham
    PartToggle.TextSize = 14
    PartToggle.Parent = MainFrame

    PartToggle.MouseButton1Click:Connect(function()
        MenuState.aimbotPart = (MenuState.aimbotPart == "Head") and "Torso" or "Head"
        PartToggle.Text = MenuState.aimbotPart
    end)

    --// Sliders
    local function createSlider(name, yPos, min, max, valueKey)
        local frame = Instance.new("Frame")
        frame.Size = UDim2.new(0.8,0,0,30)
        frame.Position = UDim2.new(0.1,0,0,yPos)
        frame.BackgroundColor3 = Color3.fromRGB(0,150,0)
        frame.Parent = MainFrame

        local UICornerFrame = Instance.new("UICorner")
        UICornerFrame.CornerRadius = UDim.new(0,6)
        UICornerFrame.Parent = frame

        local textLabel = Instance.new("TextLabel")
        textLabel.Size = UDim2.new(1,0,0.5,0)
        textLabel.BackgroundTransparency = 1
        textLabel.Position = UDim2.new(0,0,0,0)
        textLabel.Text = name .. ": " .. MenuState[valueKey]
        textLabel.TextColor3 = Color3.fromRGB(0,255,0)
        textLabel.Font = Enum.Font.Gotham
        textLabel.TextSize = 14
        textLabel.Parent = frame

        local slider = Instance.new("Frame")
        slider.Size = UDim2.new((MenuState[valueKey]-min)/(max-min),0,0.3,0)
        slider.Position = UDim2.new(0,0,0.7,0)
        slider.BackgroundColor3 = Color3.fromRGB(0,255,0)
        slider.Parent = frame

        local dragging = false
        local function update(input)
            local x = math.clamp(input.Position.X - frame.AbsolutePosition.X, 0, frame.AbsoluteSize.X)
            local percent = x / frame.AbsoluteSize.X
            MenuState[valueKey] = math.floor(min + (max-min)*percent)
            slider.Size = UDim2.new(percent,0,0.3,0)
            textLabel.Text = name .. ": " .. MenuState[valueKey]
        end

        frame.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = true
            end
        end)
        frame.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = false
            end
        end)
        UserInputService.InputChanged:Connect(function(input)
            if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                update(input)
            end
        end)
    end

    createSlider("Aimbot FOV", 500, 50, 500, "aimbotFOV")
    createSlider("Hitbox Size", 540, 5, 20, "hitboxSize")
    createSlider("Rapid Fire Delay", 580, 0.05, 1, "rapidFireDelay")

    -- FOV Circle
    local fovCircle
    local function updateFOVCircle()
        if MenuState.showFOV then
            if not fovCircle then
                fovCircle = Drawing.new("Circle")
                fovCircle.Color = Color3.fromRGB(0,255,0)
                fovCircle.Thickness = 2
                fovCircle.NumSides = 100
                fovCircle.Filled = false
            end
            local mousePos = UserInputService:GetMouseLocation()
            fovCircle.Position = Vector2.new(mousePos.X,mousePos.Y)
            fovCircle.Radius = MenuState.aimbotFOV
            fovCircle.Visible = true
        elseif fovCircle then
            fovCircle:Remove()
            fovCircle = nil
        end
    end

    -- Dragging Header
    local dragging = false
    local dragInput, mousePos, framePos
    Header.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            mousePos = input.Position
            framePos = MainFrame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    Header.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)
    RunService.RenderStepped:Connect(function()
        if dragging and dragInput then
            local delta = dragInput.Position - mousePos
            MainFrame.Position = framePos + UDim2.new(0, delta.X, 0, delta.Y)
        end
        updateFOVCircle()
    end)

    -- Right Ctrl Toggle
    UserInputService.InputBegan:Connect(function(input, gpe)
        if gpe then return end
        if input.KeyCode == Enum.KeyCode.RightControl then
            MainFrame.Visible = not MainFrame.Visible
        end
    end)

    -- Cheats Logic
    local rapidFireLast = 0
    local function isEnemy(plr)
        return plr.Team ~= player.Team
    end

    RunService.RenderStepped:Connect(function()
        -- Aimbot
        if MenuState.aimbot and UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton2) then
            local closest
            local shortest = math.huge
            local mouse = player:GetMouse()
            for _,plr in pairs(Players:GetPlayers()) do
                if plr ~= player and isEnemy(plr) and plr.Character and plr.Character:FindFirstChild(MenuState.aimbotPart) then
                    local screenPos, onScreen = Camera:WorldToViewportPoint(plr.Character[MenuState.aimbotPart].Position)
                    if onScreen then
                        local dist = (Vector2.new(screenPos.X,screenPos.Y)-Vector2.new(mouse.X,mouse.Y)).Magnitude
                        if dist < shortest and dist < MenuState.aimbotFOV then
                            shortest = dist
                            closest = plr
                        end
                    end
                end
            end
            if closest and closest.Character then
                local hrp = closest.Character[MenuState.aimbotPart]
                local delta = Camera:WorldToViewportPoint(hrp.Position) - Vector3.new(mouse.X,mouse.Y,0)
                mousemoverel(delta.X*0.5, delta.Y*0.5)
            end
        end

        -- Rapid Fire
        if MenuState.rapidfire and tick()-rapidFireLast >= MenuState.rapidFireDelay then
            rapidFireLast = tick()
            if player.Character:FindFirstChildOfClass("Tool") then
                player.Character:FindFirstChildOfClass("Tool"):Activate()
            end
        end

        -- Kill All
        if MenuState.killall then
            for _,plr in pairs(Players:GetPlayers()) do
                if plr ~= player and isEnemy(plr) and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
                    player.Character.HumanoidRootPart.CFrame = plr.Character.HumanoidRootPart.CFrame * CFrame.new(0,0,3)
                    if player.Character:FindFirstChildOfClass("Tool") then
                        player.Character:FindFirstChildOfClass("Tool"):Activate()
                    end
                end
            end
        end

        -- Hitbox Extender
        if MenuState.hitbox then
            for _,plr in pairs(Players:GetPlayers()) do
                if plr ~= player and isEnemy(plr) and plr.Character then
                    local part = plr.Character:FindFirstChild("HumanoidRootPart")
                    if part then
                        part.Size = Vector3.new(MenuState.hitboxSize,MenuState.hitboxSize,MenuState.hitboxSize)
                    end
                end
            end
        end

        -- ESP
        if MenuState.esp then
            for _,plr in pairs(Players:GetPlayers()) do
                if plr ~= player and isEnemy(plr) and plr.Character then
                    for _,part in pairs(plr.Character:GetChildren()) do
                        if part:IsA("BasePart") and not part:FindFirstChild("ESP") then
                            local box = Instance.new("BoxHandleAdornment")
                            box.Name = "ESP"
                            box.Adornee = part
                            box.AlwaysOnTop = true
                            box.ZIndex = 2
                            box.Size = part.Size
                            box.Color3 = Color3.fromRGB(0,255,0)
                            box.Transparency = 0.5
                            box.Parent = part
                        elseif part:IsA("BasePart") and part:FindFirstChild("ESP") then
                            part.ESP.Size = part.Size
                        end
                    end
                end
            end
        else
            for _,plr in pairs(Players:GetPlayers()) do
                if plr.Character then
                    for _,part in pairs(plr.Character:GetChildren()) do
                        if part:IsA("BasePart") and part:FindFirstChild("ESP") then
                            part.ESP:Destroy()
                        end
                    end
                end
            end
        end
    end)
end

-- Key Button
enterButton.MouseButton1Click:Connect(function()
    local validKeys = {
        DEVON2025 = true,
        TESTKEY882 = true
    }

    if validKeys[keyBox.Text] then
        keyLabel.Text = "Valid Key!"
        keyLabel.TextColor3 = Color3.fromRGB(0,255,0)
        wait(0.5)
        loadMenu()
    else
        keyLabel.Text = "Invalid Key!"
        keyLabel.TextColor3 = Color3.fromRGB(255,0,0)
    end
end)
